{% extends "base.html" %}

{% block title %}Tasks - Simple RDBMS Demo{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“ Add New Task</h2>
    <form method="POST" action="/tasks/add">
        <div class="form-group">
            <label for="user_id">Assign to User:</label>
            <select name="user_id" id="user_id" required>
                <option value="">Select a user...</option>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="title">Task Title:</label>
            <input type="text" name="title" id="title" placeholder="Enter task title" required>
        </div>
        
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea name="description" id="description" placeholder="Enter task description (optional)"></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary">Add Task</button>
    </form>
</div>

<div class="card">
    <h2>ğŸ“‹ All Tasks</h2>
    
    {% if tasks %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Status</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Assigned To</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                    <tr>
                        <td>{{ task['tasks.id'] }}</td>
                        <td>
                            {% if task['tasks.completed'] %}
                                <span style="color: green; font-weight: bold;">âœ“ Done</span>
                            {% else %}
                                <span style="color: orange; font-weight: bold;">â—‹ Pending</span>
                            {% endif %}
                        </td>
                        <td class="{% if task['tasks.completed'] %}completed{% endif %}">
                            {{ task['tasks.title'] }}
                        </td>
                        <td class="{% if task['tasks.completed'] %}completed{% endif %}">
                            {{ task['tasks.description'] or '-' }}
                        </td>
                        <td>{{ task['users.username'] }}</td>
                        <td>
                            <a href="/tasks/toggle/{{ task['tasks.id'] }}" class="btn btn-sm btn-success">
                                {% if task['tasks.completed'] %}Mark Pending{% else %}Mark Done{% endif %}
                            </a>
                            <a href="/tasks/edit/{{ task['tasks.id'] }}" class="btn btn-sm btn-secondary">Edit</a>
                            <a href="/tasks/delete/{{ task['tasks.id'] }}" 
                               class="btn btn-sm btn-danger"
                               onclick="return confirm('Are you sure you want to delete this task?')">
                                Delete
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p style="text-align: center; color: #6c757d; margin-top: 20px;">
            No tasks yet. Create one above!
        </p>
    {% endif %}
</div>

<div class="card" style="background: #f8f9fa;">
    <h3 style="font-size: 1.2em; color: #333;">ğŸ’¡ Demo Features</h3>
    <ul style="margin-left: 20px; margin-top: 10px; color: #555;">
        <li><strong>JOIN operation:</strong> Tasks are displayed with user information using INNER JOIN</li>
        <li><strong>CRUD operations:</strong> Create, Read, Update, and Delete tasks</li>
        <li><strong>Indexing:</strong> Tasks table has an index on user_id for faster lookups</li>
        <li><strong>Constraints:</strong> Users have unique usernames and emails</li>
        <li><strong>Foreign keys:</strong> Tasks are linked to users via user_id</li>
    </ul>
</div>
{% endblock %}
